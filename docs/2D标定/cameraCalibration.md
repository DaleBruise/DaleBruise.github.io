# 相机标定流程和相关原理
相机标定总的来讲，就是将由于相机本身的特性——“鱼眼效应”造成的畸变现象通过一定的方法修正过来。并且，我们还可以补偿相机外界旋转造成的偏移。下面将会介绍相机标定的原理和我们的解决方法, 本文章是介绍针对类似小孔成像面阵相机的标定进行介绍。 
## 1、相机畸变
为什么我们要相机标定？难道相机看到的东西，不就是我们想要的东西了吗？其实我们在一般的图像处理中是不需要进行标定流程的，只有我们需要将图像中的位置与现实中的位置对应起来以后，才需要进行一系列标定流程，相机标定只是我们标定流程中的一部分。根据项目的不同，我们需要走的标定流程不同，但是可以确认的是，相机标定是大概率被需要的，是在全套标定流程中简单但至关重要的一环，也就是相机的畸变修正。  
![pinHole Model](./docs/pinHole.png)  
对于小孔成像模型（如上图所示），一般的镜头畸变是由于透镜存在球面像差（由于透镜或者镜子的球形形状引起的像差，使得中心光线和边缘光线有不同的焦点）导致的。比如，我们投影一个直线时，越靠近边缘的部分，直线的弯曲程度就会越大。类似地，根据镜头不同的光学特性，就会有不同的畸变现象。      
### 1.1、径向畸变
我们经常遇到的畸变类型为径向畸变，径向畸变的特性就是从图像中心点出发，与靠近边缘的位置现象越明显，其大致可以分为桶型畸变和枕型畸变。  
 - **桶型畸变**中，图像的放大倍率随距主光轴（不偏移）的距离而减小，类似将一个图像投影到一个桶型或者球形的物体上。鱼眼镜头采用半球形视角，利用这种畸变可以扩大我们的视野范围，牺牲的则是物体在视野中的形变。  
 ![barrel distortion](./docs/images/2D_Calibration/barrel_distortion.png)
 - **枕型畸变**中，与桶型畸变相反，图像的放大倍数随着距主光轴（不偏移）的距离而变大，没有穿过图像中心的线条会向内弯曲。凸球面透镜往往就会产生枕型畸变。  
 ![pincushion distortion](./docs/images/2D_Calibration/pincushion_distortion.png)
如果我们想要使用数学语言去表达此类畸变的程度，那么一般来讲，我们可以使用二次多项式来表达，他们随着主光轴的距离的平方次增加。后面就会讲到我们如何使用数学方法来补偿畸变带来的误差。
### 1.2、切向畸变
切向畸变是由于感光元件和镜头不平行导致的，我们在程序中进行畸变矫正的过程中，一般不考虑切向畸变。
## 2、畸变矫正方法
相机畸变的矫正不需要我们去移动平台或者其他平面，根据张正友提出的方法，对于大多数的情况，我们只需要一张棋盘格图像即可矫正，如下图所示。  
![chessBoard](./docs/images/2D_Calibration/chessboard.png)  
棋盘格所在平面要和镜头镜头尽量平行，也就是棋盘格所在平面的Z轴要尽量与镜头所在平面垂直，从而我们的精度可以更高。搭建好平台后，我们就可开始对相机进行建模，相机可以视为小孔成像模型，在此模型下，我们使用一个变换矩阵来将实际的坐标点投影到屏幕上：
$$ sm' = A[R|t]M' $$  
或者 $$s\begin{bmatrix}u \\ v \\ 1 \end{bmatrix}
= \begin{bmatrix} f_x & 0 & c_x \\ 0 & f_y & c_y \\ 0 & 0 & 1 \end{bmatrix}
\begin{bmatrix} r_{11} & r_{12} & r_{13} & t_1 \\ r_{21} & r_{22} & r_{23} & t_2 \\ r_{31} & r_{32} & r_{33} & t_3 \end{bmatrix}
\begin{bmatrix} X \\ Y \\ Z \\ 1 \end{bmatrix}
$$  
其中：
  - $(X,Y,Z)$是实际坐标点
  - $(u,v)$是投影到图像坐标系下的坐标点
  - 矩阵 $A$ 中保存的信息是相机的内参
  - $(c_x, c_y)$是图像中心坐标
  - $f_X,f_y$是以像素为单位的焦距
如果我们想要将模型应用在变焦镜头中，由于 $f_x,f_y$ 改变了，所以对于不同焦距的镜头，我们需要进行不同的建模。反之，如果仅仅只是对图像的等比例放大和缩小，那么这个模型就可以反复使用不需要额外改变。
根据我们上述描述的相机模型，我们可以使用一下流程来对相机畸变的修正：  
 1.世界坐标系点->相机坐标系点
 2.相机坐标系点->图像坐标系点
 3.图像坐标系点->应用相机径向畸变后的图像坐标系点
 4.*应用相机径向畸变后的图像坐标系点->应用相机切向畸变后的图像坐标系点（选择性）
 5.应用相机畸变后的点->真实图像坐标系下的点  
### 2.1、世界坐标系点->相机坐标系点
旋转矩阵 $[R|t]$ 是相机的外参矩阵，该矩阵是用来描述相机外部的旋转情况。也就是说，该矩阵将点 $(X,Y,Z)$ 转换为相机固定的坐标系。

